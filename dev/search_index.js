var documenterSearchIndex = {"docs":
[{"location":"references/#References","page":"References","title":"References","text":"","category":"section"},{"location":"references/","page":"References","title":"References","text":"F. Ederer. The relative survival rate: a statistical methodology. Natl. Cancer Inst. Monogr. 6, 101–121 (1961).\n\n\n\nF. Ederer and H. Heise. The effect of eliminating deaths from cancer in general survival rates, methodological notes 11. End Result Evaluation Section, National Cancer Institute (1959).\n\n\n\nT. Hakulinen. On long-term relative survival rates. Journal of Chronic Diseases 30, 431–443 (1977).\n\n\n\nM. P. Perme, J. Stare and J. Estève. On Estimation in Relative Survival. Biometrics 68, 113–120 (2011).\n\n\n\nN. Grafféo, F. Castell, A. Belot and R. Giorgi. A Log-Rank-Type Test to Compare Net Survival Distributions. Biometrics 72, 760–769 (2016).\n\n\n\nK. A. Cronin and E. J. Feuer. Cumulative cause-specific mortality for cancer patients in the presence of other causes: a crude analogue of relative survival. Statistics in medicine 19, 1729–1740 (2000).\n\n\n\nT. R. Fleming and D. P. Harrington. Counting Processes and Survival Analysis. Vol. 625 (John Wiley & Sons, 2013).\n\n\n\nP. K. Andersen, O. Borgan, R. D. Gill and N. Keiding. Statistical Models Based on Counting Processes. Springer Series in Statistics (Springer US, New York, NY, 1993).\n\n\n\nM. P. Perme and K. Pavlic. Nonparametric relative survival analysis with the R package relsurv. Journal of Statistical Software 87, 1–27 (2018).\n\n\n\nH. Charvat and A. Belot. Mexhaz: An R package for fitting flexible hazard-based regression models for overall and excess mortality with a random effect. Journal of Statistical Software 98, 1–36 (2021).\n\n\n\n","category":"page"},{"location":"references/","page":"References","title":"References","text":"T. Hakulinen and K. H. Abeywickrama. A computer program package for relative survival analysis. Computer programs in biomedicine 19, 197–207 (1985).\n\n\n\nT. Hakulinen and L. Tenkanen. Regression analysis of relative survival rates. Journal of the Royal Statistical Society Series C: Applied Statistics 36, 309–317 (1987).\n\n\n\n","category":"page"},{"location":"benches/","page":"Benchmarking results","title":"Benchmarking results","text":"CurrentModule = NetSurvival","category":"page"},{"location":"benches/#Benchmarking-results","page":"Benchmarking results","title":"Benchmarking results","text":"","category":"section"},{"location":"benches/","page":"Benchmarking results","title":"Benchmarking results","text":"The following benchmarks are run on github actions continuous integration platform, which is a very slow computing engine. Local experiments suggests performances that are twice as fast on correct hardware – note that we do not use multithreading at all, but underlying BLAS calls might. ","category":"page"},{"location":"benches/","page":"Benchmarking results","title":"Benchmarking results","text":"using RCall\nusing NetSurvival, RateTables, BenchmarkTools\n\nR_bench = @benchmark R\"\"\"\nrelsurv::rs.surv(\n    survival::Surv(time, stat) ~1, \n    rmap=list(age = age, sex = sex, year = diag), \n    data = relsurv::colrec, \n    ratetable = relsurv::slopop, \n    method = \"pohar-perme\", \n    add.times=1:8149)\n\"\"\"\n\njl_bench = @benchmark fit(PoharPerme, @formula(Surv(time,status)~1), colrec, slopop)\n\nratio = time(minimum(R_bench)) / time(minimum(jl_bench))","category":"page"},{"location":"benches/#Benchmarking-across-time","page":"Benchmarking results","title":"Benchmarking across time","text":"","category":"section"},{"location":"benches/","page":"Benchmarking results","title":"Benchmarking results","text":"The folloiwng charts provide a glimpse of NetSurvival.jl's performance along time: ","category":"page"},{"location":"benches/","page":"Benchmarking results","title":"Benchmarking results","text":"<iframe src=\"../../benchmarks/\" style=\"height:500px;width:100%;\"></iframe>","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"CurrentModule = NetSurvival","category":"page"},{"location":"getting_started/#Getting-Started","page":"Getting Started","title":"Getting Started","text":"","category":"section"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"In many population-based studies, the specific cause of death is unidentified, unreliable or even unavailable. Relative survival analysis addresses this scenario, previously unexplored in general survival analysis. Different methods were created with the aim to construct a consistant and reliable estimator for this purpose.","category":"page"},{"location":"getting_started/#Net-survival-settings","page":"Getting Started","title":"Net survival settings","text":"","category":"section"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"Note first that, for any positive random variable X, we will use extensively the following functions (that each fully characterize the distribution of X): ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"Function symbol and definition Function Name\nS_X(t) = mathbb P(X  t) Survival function\nLambda_X(t) = -ln S_X(t) Cumulative Hazard function\nlambda_X(t) = partial lambda_X(t) Instantaneous hazard function","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"Consider a study that consists of censored survival times from a specific cause. Such a study consists of several random objects: ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"Random variable Name Is it observed ?\nE \"Excess\" lifetime ✘\nP \"Population\" lifetime ✘\nO = E wedge P \"Overall\" lifetime ✘\nC \"Censoring\" time ✘\nmathbf D Vector of covariates ✔\nT = O wedge C Event time ✔\nDelta = mathbf1T leq C Event status ✔","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"It is important to note that we do not observe a a potential indicator mathbf1E geq P. This is one of the key differences between net survival and standard survival. The standard Net survival analysis solves this problem by assuming that the underlying times E and P are independent from each other.","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"One central hypothesis in net survival (on top of non-informative censoring) is that P and E are independent. This independence can be written in terms of hazard rates lambda_O(t) = lambda_P(t) + lambda_E(t), or in terms of survival functions S_O(t) = S_P(t)S_E(t).","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"The population hazard for each individual lambda_P_i is usally drawn from a reference life table, and may depend on covariates mathbf D_i such as age and date, sex, country, race, etc... See the RateTables.jl package for more details on the potential covariates. On the other hand, the excess mortality is assumed to be i.i.d. between individuals and not to depend on covariates at all. Thus, we mostly omit these covariates from our notations.","category":"page"},{"location":"getting_started/#Crude-Mortality","page":"Getting Started","title":"Crude Mortality","text":"","category":"section"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"The crude mortality rate is the mortality rate from all causes of death for a population. This measure does not use the cause of death information which, as we previously mentioned, can be unreliable and incomplete. For this reason, we wish to estimate:","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"F_C(t) = int_0^t S_O(u-) lambda_E(u)du","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"The Cronin-Feuer estimator [6] is thus introduced as:","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"hatF_C(t) = int_0^t hatS_O(u-) hatlambda_E(u)du","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"where, traditionally, Kaplan-Meier is used to estimate the overall survival function hatS_O and Ederer II is used for the excess hazard rate hatlambda_E and the population hazard rate hatlambda_P.","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"Our implementation is a bit more permissive, as any net survival estimators can be used for hatlambda_E and  hatlambda_P. Of course, the default is still the original Ederer II which provides the original Cronin-Feuer estimator. ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"CrudeMortality","category":"page"},{"location":"getting_started/#NetSurvival.CrudeMortality","page":"Getting Started","title":"NetSurvival.CrudeMortality","text":"CrudeMortality\n\nThis method calculates the crude mortality and presents both the excess mortality and population mortality rates.\n\nThe default Cronin-Feuer estimator can be fitted to data with the following interface: \n\nfit(CrudeMortality, args...)\n\nwhere the args are passed to fit(EdererII,args...) to compute the excess hazard.\n\nA more direct syntax can be used, specifying directly the estimator for the excess hazard:\n\nCrudeMortality(fit(EdererII,args...))\n\nTo use another excess hazard estimator, simply replace EdererII with the method of your choice (PoharPerme, EdererI, Hakulinen).\n\nReferences: \n\n[6] Cronin, Kathleen A and Feuer, Eric J (2000). Cumulative cause-specific mortality for cancer patients in the presence of other causes: a crude analogue of relative survival.\n\n\n\n\n\n","category":"type"},{"location":"getting_started/#Available-Estimators","page":"Getting Started","title":"Available Estimators","text":"","category":"section"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"The estimation of net survival is usually discussed in terms of the estimation of the cumulative excess hazard Lambda_E(t) and/or the instantaneous hazard lambda_E = partialLambda_E. To describe the estimators, we use the following counting processes notations, similar to standard survival analysis(see e.g. [7] or [8]). ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"The uncensored event indicatrix partial N_i(t) for individual i at time t \nThe total number of uncensored events process partial N(t) = sum_i partial N_i(t) at time t\nThe at-risk indicatrix Y_i(t), for whether an individual is still at risk \nThe total number at risk process Y(t) = sum_i Y_i(t) at time t","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"With these definitions and assumptions in mind, we will now present the four different methods implemented in this package, commonly used in literature, to estimate the excess hazard function partialLambda_E(t) and its variance. Recall that we estimate the variance as sigma_E^2(t) = int_0^t partialsigma_E^2(s). ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"Name Reference Proposed (partial) Excess Hazard partialhatLambda_E(s) Proposed (partial) Variance partialhatsigma_E^2(s)\nEderer I [1] fracsum_i N_i(s)sum_i Y_i(s) - fracsum_i S_P_i(s)partialLambda_P_i(s)sum_i S_P_i(s) fracsum_i N_i(s)left(sum_i Y_i(s)right)^2\nEderer II [2] fracsum_i N_i(s)sum_i Y_i(s) - fracsum_i Y_i(s)partialLambda_P_i(s)sum_i Y_i(s) fracsum_i N_i(s)left(sum_i Y_i(s)right)^2\nHakulinen [3] fracsum_i N_i(s)sum_i Y_i(s) - fracsum_i fracY_i(s) S_P_i(s)partialLambda_P_i(s)sum_i fracY_i(s) S_P_i(s) fracsum_i N_i(s)left(sum_i Y_i(s)right)^2\nPohar Perme [4] fracsum_i fracpartial N_i(s)S_P_i(s) - sum_i fracY_i(s)S_P_i(s)partialLambda_P_i(s)sum_i fracY_i(s)S_P_i(s) fracsum_i=1^n fracpartial N_i(s)S^2_P_ileft(sum_i fracY_i(s)S_p_i(s)right)^2","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"where, in the variances, it is understood that when no more individuals are at risk 00 gives 0. ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"The Pohar Perme estimator [4] is the newest addition to relative survival analysis between the four methods, particularly designed to handle situations where covariates may change over time. It is trusted from the field (see e.g. [9] and [10]) that only this estimator should really be used, the other ones being included mostly for historical reasons and comparisons. ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"PoharPerme\nEdererI\nEdererII\nHakulinen","category":"page"},{"location":"getting_started/#NetSurvival.PoharPerme","page":"Getting Started","title":"NetSurvival.PoharPerme","text":"PoharPerme\n\nThis method estimates net survival probabilities by applying the following estimation:\n\npartialhatLambda_E(t) = fracsum_i fracdN_i(u)S_P_i(u) - sum_i fracY_i(u)S_P_i(u)dLambda_P_i(u)sum_i fracY_i(u)S_P_i(u)\n\nTo fit the Pohar Perme to your data based on a certain rate table, apply the example below to your code : \n\nfit(PoharPerme, @formula(Surv(time,status)~covariable1 + covariable2), data, ratetable)\n\nReferences: \n\n[4] Perme, Maja Pohar and Stare, Janez and Estève, Jacques (2012). On Estimation in Relative Survival.\n\n\n\n\n\n","category":"type"},{"location":"getting_started/#NetSurvival.EdererI","page":"Getting Started","title":"NetSurvival.EdererI","text":"EdererI\n\nThis method estimates net survival probabilities by applying the following estimation:\n\npartialhatLambda_E(t) = fracsum_i N_i(u)sum_i Y_i(u) - fracsum_i S_P_i(u)dLambda_P_i(u)sum_i S_P_i(u)\n\nTo call this function: \n\nfit(EdererI, @formula(Surv(time,status)~covariable1 + covariable2), data, ratetable)\n\n\n\n\n\n","category":"type"},{"location":"getting_started/#NetSurvival.EdererII","page":"Getting Started","title":"NetSurvival.EdererII","text":"EdererII\n\nThis method estimates net survival probabilities by applying the following estimation:\n\npartialhatLambda_E(t) = fracsum_i N_i(u)sum_i Y_i(u) - fracsum_i Y_i(u)dLambda_P_i(u)sum_i Y_i(u)\n\nTo call this function: \n\nfit(EdererII, @formula(Surv(time,status)~covariable1 + covariable2), data, ratetable)\n\n\n\n\n\n","category":"type"},{"location":"getting_started/#NetSurvival.Hakulinen","page":"Getting Started","title":"NetSurvival.Hakulinen","text":"Hakulinen\n\nTo call this function: \n\nfit(Hakulinen, @formula(Surv(time,status)~covariable1 + covariable2), data, ratetable)\n\n\n\n\n\n","category":"type"},{"location":"getting_started/#Grafféo-Log-Rank-Test","page":"Getting Started","title":"Grafféo Log-Rank Test","text":"","category":"section"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"The Grafféo Log-Rank Test [5] was constructed as a complement to the Pohar Perme estimator, aiming to compare the net survival functions provided by the latter. The test  is designed to compare these functions across multiple groups, including stratified covariables, and to ultimately determine, with the given p-value, which covariables are impactful to the study.","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"The null (H_0) hypothesis tests the following assumption:","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"forall t in 0T   Lambda_Eg_1(t) = Lambda_Eg_2(t) =  = Lambda_Eg_k(t)","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"where G = g_1g_k is a partition of 1n consisting of disjoint groups of individuals that we wish to compare to each other.  For all group g in G, let's denote the numerator and denominator of the Pohar Perme (partial) excess hazard estimators, restricted to individuals in the group, by: ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"partial N_Eg(s) = sum_i in g fracpartial N_i(s)S_P_i(s) - fracY_i(s)S_P_i(s)partialLambda_P_i(s)\nY_Eg(s) = sum_i in g fracY_i(s)S_P_i(s)\nR_g(s) = fracY_Eg(s)sum_gin G Y_Eg(s)","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"Then, define the vector mathbf Z = left(Z_g_r  r in 1k-1 right) with entries: ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"Z_g(T) = N_Eg(s) - int_0^T Y_Eg(s) partialhatLambda_E(s)","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"The test statistic is then given by:","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"U(T) = mathbf Z(T)hatSigma_Z^-1 mathbf Z(T)","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"where the entries of the hatSigma_Z matrix are given by: ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"sigma_gh(T) = int_0^T sum_ell in G left(delta_gell - R_g(t) right)left(delta_hell - R_h(t)right) left(sum_iinell fracpartial N_i(s)S^2_P_iright)","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"Under H_0, the statistic U(T) is asymptotically chi^2(k-1)-distributed. We thus reject the H_0 hypothesis when the p-value obtained is under 005, admitting the notable difference between the groups. ","category":"page"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"GraffeoTest","category":"page"},{"location":"getting_started/#NetSurvival.GraffeoTest","page":"Getting Started","title":"NetSurvival.GraffeoTest","text":"GraffeoTest\n\nThe Grafféo test is a log-rank type test and is typically used in net survival analysis to determine the impact of certain covariates in the study.\n\nThe null (H_0) hypothesis tests the following assumption:\n\nforall t in 0T Lambda_Eg_1(t) = Lambda_Eg_2(t) =  = Lambda_Eg_k(t)\n\nwhere G = g_1g_k is a partition of 1n consisting of disjoint groups of individuals that we wish to compare to each other.  For all group g in G, let's denote the numerator and denominator of the Pohar Perme (partial) excess hazard estimators, restricted to individuals in the group, by: \n\npartial N_Eg(s) = sum_i in g fracpartial N_i(s)S_P_i(s) - fracY_i(s)S_P_i(s)partialLambda_P_i(s)\nY_Eg(s) = sum_i in g fracY_i(s)S_P_i(s)\nR_g(s) = fracY_Eg(s)sum_gin G Y_Eg(s)\n\nThen, define the vector mathbf Z = left(Z_g_r r in 1k-1 right) with entries: \n\nZ_g(T) = N_Eg(s) - int_0^T Y_Eg(s) partialhatLambda_E(s)\n\nThe test statistic is then given by:\n\nU(T) = mathbf Z(T)hatSigma_Z^-1 mathbf Z(T)\n\nwhere the entries of the hatSigma_Z matrix are given by: \n\nsigma_gh(T) = int_0^T sum_ell in G left(delta_gell - R_g(t) right)left(delta_hell - R_h(t)right) left(sum_iinell fracpartial N_i(s)S^2_P_iright)\n\nUnder H_0, the statistic U(T) is asymptotically chi^2(k-1)-distributed.\n\nTo apply the test to your data based on a certain rate table, apply the example below to your code : \n\nfit(GraffeoTest, @formula(Surv(time,status)~covariable1 + covariable2), data, ratetable)\n\nIf you wish to stratify a covariate:\n\nfit(GraffeoTest, @formula(Surv(time,status)~covariable1 + Strata(covariable2)), data, ratetable)\n\nThe produced test statistics is supposed to follow a chi squared distribution under (H_0). You can fetch the results using the .stat, .df and .pval fields of the returned object. \n\nReferences: \n\n[5] Grafféo, Nathalie and Castell, Fabienne and Belot, Aurélien and Giorgi, Roch (2016). A Log-Rank-Type Test to Compare Net Survival Distributions.  \n\n\n\n\n\n","category":"type"},{"location":"getting_started/#References","page":"Getting Started","title":"References","text":"","category":"section"},{"location":"getting_started/","page":"Getting Started","title":"Getting Started","text":"F. Ederer. The relative survival rate: a statistical methodology. Natl. Cancer Inst. Monogr. 6, 101–121 (1961).\n\n\n\nF. Ederer and H. Heise. The effect of eliminating deaths from cancer in general survival rates, methodological notes 11. End Result Evaluation Section, National Cancer Institute (1959).\n\n\n\nT. Hakulinen. On long-term relative survival rates. Journal of Chronic Diseases 30, 431–443 (1977).\n\n\n\nM. P. Perme, J. Stare and J. Estève. On Estimation in Relative Survival. Biometrics 68, 113–120 (2011).\n\n\n\nN. Grafféo, F. Castell, A. Belot and R. Giorgi. A Log-Rank-Type Test to Compare Net Survival Distributions. Biometrics 72, 760–769 (2016).\n\n\n\nK. A. Cronin and E. J. Feuer. Cumulative cause-specific mortality for cancer patients in the presence of other causes: a crude analogue of relative survival. Statistics in medicine 19, 1729–1740 (2000).\n\n\n\nT. R. Fleming and D. P. Harrington. Counting Processes and Survival Analysis. Vol. 625 (John Wiley & Sons, 2013).\n\n\n\nP. K. Andersen, O. Borgan, R. D. Gill and N. Keiding. Statistical Models Based on Counting Processes. Springer Series in Statistics (Springer US, New York, NY, 1993).\n\n\n\nM. P. Perme and K. Pavlic. Nonparametric relative survival analysis with the R package relsurv. Journal of Statistical Software 87, 1–27 (2018).\n\n\n\nH. Charvat and A. Belot. Mexhaz: An R package for fitting flexible hazard-based regression models for overall and excess mortality with a random effect. Journal of Statistical Software 98, 1–36 (2021).\n\n\n\n","category":"page"},{"location":"","page":"Home","title":"Home","text":"CurrentModule = NetSurvival","category":"page"},{"location":"#Introduction","page":"Home","title":"Introduction","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The NetSurvival.jl package provides the necessary tools to perform estimations and analysis in the Net Survival field. This specialized branch of Survival Analysis focuses on estimating the probability of survival from a specific event of interest, for example a given cancer, without considering other causes of death. This is especially relevant in the (unfortunately quite common) case where the cause of death indicatrix is either unavailable or untrustworthy. Consequently, the so-called missing indicatrix issue forbids the use of standard competitive risks survival analysis methods on these datasets.  For that, a few standard estimators were established in the last 50 years, backed by a wide literature.","category":"page"},{"location":"","page":"Home","title":"Home","text":"By integrating observed data from the target population with historical population mortality data (usually sourced from national census datasets), Net Survival allows the extraction of the specific mortality hazard associated with the particular disease, even under the missing indicatrix issue. The concept of relative survival analysis dates back several decades to the seminal article by Ederer, Axtell, and Cutler in 1961 [1] and the one by Ederer and Heise in 1959 [2].","category":"page"},{"location":"","page":"Home","title":"Home","text":"For years, the Hakulinen estimator (1977) [3] and the Ederer I and II estimators were widely regarded as the gold standard for non-parametric survival curve estimation. However, the introduction of the Pohar-Perme, Stare, and Estève estimator in 2012 [4] resolved several issues inherent in previous estimators, providing a reliable and consistent non-parametric estimator for net survival analysis.","category":"page"},{"location":"#Features","page":"Home","title":"Features","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Standard tools nowadays are composed of R packages, with underlying C and C++ routines, that are hard to read, maintain, and use. This package is an attempt to bring standard relative survival analysis modeling routines to Julia, while providing an interface that is close to the relsurv standard, albeit significantly faster and easier to maintain in the future. Our hope is that the junction with classical modeling API in Julia will allow later extensions of the existing modeling methods, with a simple interface for the practitioners.","category":"page"},{"location":"","page":"Home","title":"Home","text":"Some key features in NetSurvival.jl are:","category":"page"},{"location":"","page":"Home","title":"Home","text":"A panel of different non-parametric net survival estimators (Ederer I [1], Ederer II [2], Hakulinen [3], Pohar Perme [4]) with an interface compliant with Julia's standards. \nGrafféo's log-rank test [5] to compare net survival curves accross groups, including stratified testing.\nA compact, readable and efficient codebase (up to 1000x less LOC than relsurv for the same functionalities), ensuring long-term maintenability.\nSignificant performance improvements (up to 50x) compared to the R package relsurv.","category":"page"},{"location":"#Installation","page":"Home","title":"Installation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The package is not yet available on Julia's general registry, and thus can be installed through the following command:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using Pkg\nPkg.add(\"https://github.com/JuliaSurv/NetSurvival.jl.git\")","category":"page"},{"location":"","page":"Home","title":"Home","text":"See the rest of this documentation to have a glimpse of the functionalities!","category":"page"},{"location":"#References","page":"Home","title":"References","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"F. Ederer. The relative survival rate: a statistical methodology. Natl. Cancer Inst. Monogr. 6, 101–121 (1961).\n\n\n\nF. Ederer and H. Heise. The effect of eliminating deaths from cancer in general survival rates, methodological notes 11. End Result Evaluation Section, National Cancer Institute (1959).\n\n\n\nT. Hakulinen. On long-term relative survival rates. Journal of Chronic Diseases 30, 431–443 (1977).\n\n\n\nM. P. Perme, J. Stare and J. Estève. On Estimation in Relative Survival. Biometrics 68, 113–120 (2011).\n\n\n\nN. Grafféo, F. Castell, A. Belot and R. Giorgi. A Log-Rank-Type Test to Compare Net Survival Distributions. Biometrics 72, 760–769 (2016).\n\n\n\n","category":"page"},{"location":"example/#Case-study","page":"Case study","title":"Case study","text":"","category":"section"},{"location":"example/#Introduction-and-datasets","page":"Case study","title":"Introduction and datasets","text":"","category":"section"},{"location":"example/","page":"Case study","title":"Case study","text":"We will illustrate with an example using the dataset colrec, which comprises 5971 patients diagnosed with colon or rectal cancer  between 1994 and 2000. This dataset is sourced from the Slovenia cancer registry. Given the high probability that the patients are Slovenian, we will be using the Slovenian mortality table slopop as reference for the populational rates. Subsequently, we can apply various non-parametric estimators for net survival analysis.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"note: N.B.\nMortality tables may vary in structure, with options such as the addition or removal of specific covariates. To confirm that the mortality table is in the correct format, please refer to RateTables.jl's documentation, or directly extract it from there.","category":"page"},{"location":"example/#Cohort-details","page":"Case study","title":"Cohort details","text":"","category":"section"},{"location":"example/","page":"Case study","title":"Case study","text":"The patients in the study are diagnosed between January 1st 1994 and December 31st 2000. Before we move on to the survival probabilities, it is important to be aware of how your data is distributed and of what it comprises. ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"using NetSurvival, RateTables, DataFrames\n\nfirst(colrec,10)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Let's explore how our data is distributed first, strating with the age variable.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"println(minimum(colrec.age./365.241), \" ; \",maximum(colrec.age./365.241))","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"The study can be considered diverse in terms of age seeing as the patients are between 12 and 96 years old, approximately. ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"using Plots \n\nplot(\n    histogram(colrec.age./365.241, label=\"Age\"),\n    histogram(colrec.time./365.241, label=\"Follow-up time\")\n)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"The graph above show us that although it has a wide range of patients within all age groups, it is mostly centered around older adults and elderly, with the majority of the patients being between 60 and 80 years old. ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Looking at the second graph that details the distibution of the follow-up times, we notice that the values quickly drop. Unfortunately, this is a common theme in cancer studies. ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Let's take a look at the sex variable now: ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"combine(groupby(colrec, :sex), nrow)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"This dataframe shows the number of male and female patients. There isn't too big of a difference between the two. We can say this study includes both gender relatively equally, thus, reducing bias. ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"With these two observations, it is also worth noting that colorectal cancer is most common with men and people older than 50.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"In total, we note that we have 5971 patients. By taking a look at the status variable, we can determine the deaths and censorship:","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"sum(colrec.status)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Out of the 5971 patients, 4979 have died. This is a very high mortality rate, and again, unfortunately common in cancer studies.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"(nrow(colrec) - sum(colrec.status)) / nrow(colrec)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"In other terms, the censorship rate is of 16.6%, meaning the event, in this case death, was not observed for only 16.6% of the patients. This is a low censorship rate and thus the quality of the signal will be pretty good. ","category":"page"},{"location":"example/#Mortality-table","page":"Case study","title":"Mortality table","text":"","category":"section"},{"location":"example/","page":"Case study","title":"Case study","text":"We will be using the mortality table slopop taken from the RateTables.jl package as the study is done on Slovenian patients. ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"slopop","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"By examining slopop, we notice it contains information regarding age and year, as expected for mortality tables. Additionally, it incorporates the covariate sex, which has two possible entries (:male or :female). The ratetable is then three dimensional, with the covariate sex added. For example, the daily hazard rate for a woman turning 45 on the January 1st 2006 can be accessed through the following command:","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"daily_hazard(slopop, 45*365.241, 2006*365.241; sex=:female)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Making the survival probability easily calculated with:","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"exp(-(daily_hazard(slopop, 45*365.241, 2006*365.241; sex=:female))*365)","category":"page"},{"location":"example/#Overall-and-expected-survival","page":"Case study","title":"Overall and expected survival","text":"","category":"section"},{"location":"example/","page":"Case study","title":"Case study","text":"For this part, we will be using the Survival.jl package to apply the Kaplan Meier estimator for the overall survival.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"using Survival \n\nkm = fit(KaplanMeier, colrec.time./365.241, colrec.status)\nplot(km.events.time, km.survival, label=false, title = \"Kaplan-Meier Estimator for the Overall Survival\")","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"The graph above indicates a significant dip in survival probability within the first 5 years, and even more at 10 years. This period in the study is then crucial for the analysis. ","category":"page"},{"location":"example/#Estimated-net-survival","page":"Case study","title":"Estimated net survival","text":"","category":"section"},{"location":"example/","page":"Case study","title":"Case study","text":"In this part, we are interested in the first 5 years of the study. We will thus limit the follow-up time to 5 years, meaning we will censor all individuals with a follow-up time that is higher than this. Then, we will apply the different net survival methods.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"colrec.time5 .= 0.0\ncolrec.status5 .= Bool(true)\nfor i in 1:nrow(colrec)\n    colrec.time5[i] = min(colrec.time[i], round(5*365.241))\n    if colrec.time[i] > 5*365.241\n        colrec.status5[i] = false\n    end\nend","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Now that we have defined our own time and status variables according to the observations made, we can apply the different non parametric methods for relative survival.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"e1 = fit(EdererI, @formula(Surv(time5,status5)~1), colrec, slopop)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"With the EdererI method, after 1826 days have passed, we can say that the survival rate at this mark is around 0456, in the hypothetical world where patients can only die of cancer.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"crude_e1 = CrudeMortality(e1)\nprintln(crude_e1.Λₒ[1826], \" , \", crude_e1.Λₑ[1826], \" , \", crude_e1.Λₚ[1826])","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Out of the 0.63 patients that have died, according to the EdererI method, 0.51 died because of colorectal cancer and 0.12 died of other causes.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"e2 = fit(EdererII, @formula(Surv(time5,status5)~1), colrec, slopop)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Similarily, the EdererII method, also known as the conditional method, shows that at the 5 year mark, the survival probability is of 044 in this hypothetical world.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"crude_e2 = CrudeMortality(e2)\nprintln(crude_e2.Λₒ[1826], \" , \", crude_e2.Λₑ[1826], \" , \", crude_e2.Λₚ[1826])","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Here, out of the 0.63 patients that have dued, 0.53 are due to colorectal cancer and 0.1 due to other causes.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"pp = fit(PoharPerme, @formula(Surv(time5,status5)~1), colrec, slopop)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"We conclude for the Poher-Perme method, that in a world where cancer patients could only die due to cancer, only 41% of these patients would still be alive 5 year after their diagnosis.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"crude_pp = CrudeMortality(pp)\nprintln(crude_pp.Λₒ[1826], \" , \", crude_pp.Λₑ[1826], \" , \", crude_pp.Λₚ[1826])","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Finally, for this estimator, we have that of the 0.64 patients that have died, 0.53 is due to colorectal cancer while 0.11 is due to other causes.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"We will plot the Pohar Perme method only.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"conf_int = confint(pp; level = 0.05)\nlower_bounds = [lower[1] for lower in conf_int]\nupper_bounds = [upper[2] for upper in conf_int] \n\np1 = plot(pp.grid, pp.Sₑ, ribbon=(pp.Sₑ - lower_bounds, upper_bounds - pp.Sₑ), xlab = \"Time (days)\", ylab = \"Net survival\", label = false)\n\np2 = plot(pp.grid, crude_pp.Λₑ, label = \"Excess Mortality Rate\")\np2 = plot!(pp.grid, crude_pp.Λₚ, label = \"Population Mortality Rate\")\n\nplot(p1,p2)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Looking at the graph, and the rapid dip it takes, it is evident that the first 5 years are crucial and that the survival probability is highly affected in these years. Additionnally, the crude mortality graph allows us to see how much of this curve is due to the colorectacl cancer studied versus other undefined causes. It is clear that the large majority is due to the cancer.","category":"page"},{"location":"example/#Net-survival-with-respect-to-covariates","page":"Case study","title":"Net survival with respect to covariates","text":"","category":"section"},{"location":"example/","page":"Case study","title":"Case study","text":"We are now interested in comparing the different groups of patients defined by various covariates. ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"pp_sex = fit(PoharPerme, @formula(Surv(time5,status5)~sex), colrec, slopop)\npp_males = pp_sex[pp_sex.sex .== :male,:estimator][1]\npp_females = pp_sex[pp_sex.sex .== :female,:estimator][1]","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"When comparing at time 1826, we notice that the survival probability is slightly inferior for men than for women (0433  0449). It is also more probable for the women to die from other causes than the men seeing as 00255  0025. Still, the differences are minimal. Let's confirm this with the Grafféo log-rank test:","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"test_sex = fit(GraffeoTest, @formula(Surv(time5,status5)~sex), colrec, slopop)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"The p-value is indeed above 005. We cannot reject the null hypothesis H_0 and thus we dismiss the differences between the two sexes.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"As for the age, we will define two different groups: individuals aged 65 and above and those who are not.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"colrec.age65 .= ifelse.(colrec.age .>= 65*365.241, :old, :young)\npp_age65 = fit(PoharPerme, @formula(Surv(time5,status5)~age65), colrec, slopop)\npp_young = pp_age65[pp_age65.age65 .== :young, :estimator][1]\npp_old = pp_age65[pp_age65.age65 .== :old, :estimator][1]","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Here, the difference between the two is much more important. In the first group, the individuals are aged under 65 and at 5 years time, they have a 501% chance of survival. On the other hand, the individuals aged 65 and up have a 401% chance of survival. ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"It is also worth noting that their chances of dying from other causes is higher than the younger group, given their age. ","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"When applying the Grafféo test, we get the results below:","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"test_age65 = fit(GraffeoTest, @formula(Surv(time5,status5)~age65), colrec, slopop)","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"The p-value is well under 005, meaning we reject the H_0 hypothesis and must admit there are differences between the individuals aged 65 and above and the others.","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"When plotting both we get:","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"conf_int_men = confint(pp_males; level = 0.05)\nlower_bounds_men = [lower[1] for lower in conf_int_men]\nupper_bounds_men = [upper[2] for upper in conf_int_men] \n\nconf_int_women = confint(pp_females; level = 0.05)\nlower_bounds_women = [lower[1] for lower in conf_int_women]\nupper_bounds_women = [upper[2] for upper in conf_int_women]\n\nconf_int_under65 = confint(pp_young; level = 0.05)\nlower_bounds_under65 = [lower[1] for lower in conf_int_under65]\nupper_bounds_under65 = [upper[2] for upper in conf_int_under65] \n\nconf_int_65 = confint(pp_old; level = 0.05)\nlower_bounds_65 = [lower[1] for lower in conf_int_65]\nupper_bounds_65 = [upper[2] for upper in conf_int_65] \n\nplot1 = plot(pp_males.grid, pp_males.Sₑ, ribbon=(pp_males.Sₑ - lower_bounds_men, upper_bounds_men - pp_males.Sₑ), xlab = \"Time (days)\", ylab = \"Net survival\", label = \"men\")\nplot1 = plot!(pp_females.grid, pp_females.Sₑ, ribbon=(pp_females.Sₑ - lower_bounds_women, upper_bounds_women - pp_females.Sₑ), xlab = \"Time (days)\", ylab = \"Net survival\", label = \"women\")\n\nplot2 = plot(pp_young.grid, pp_young.Sₑ, ribbon=(pp_young.Sₑ - lower_bounds_under65, upper_bounds_under65 - pp_young.Sₑ), xlab = \"Time (days)\", ylab = \"Net survival\", label = \"Under 65\")\nplot2 = plot!(pp_old.grid, pp_old.Sₑ, ribbon=(pp_old.Sₑ - lower_bounds_65, upper_bounds_65 - pp_old.Sₑ), xlab = \"Time (days)\", ylab = \"Net survival\", label = \"65 and up\")\n\nplot(plot1, plot2, layout = (1, 2))","category":"page"},{"location":"example/","page":"Case study","title":"Case study","text":"Visually, it is almost immediately understood that there are no worthy differences between the two sexes whereas the age65 variable seems to play a big role.","category":"page"}]
}
