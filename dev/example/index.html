<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Case study · NetSurvival.jl</title><meta name="title" content="Case study · NetSurvival.jl"/><meta property="og:title" content="Case study · NetSurvival.jl"/><meta property="twitter:title" content="Case study · NetSurvival.jl"/><meta name="description" content="Documentation for NetSurvival.jl."/><meta property="og:description" content="Documentation for NetSurvival.jl."/><meta property="twitter:description" content="Documentation for NetSurvival.jl."/><meta property="og:url" content="https://JuliaSurv.github.io/NetSurvival.jl/example/"/><meta property="twitter:url" content="https://JuliaSurv.github.io/NetSurvival.jl/example/"/><link rel="canonical" href="https://JuliaSurv.github.io/NetSurvival.jl/example/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">NetSurvival.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting Started</a></li><li class="is-active"><a class="tocitem" href>Case study</a><ul class="internal"><li><a class="tocitem" href="#Introduction-and-datasets"><span>Introduction and datasets</span></a></li><li><a class="tocitem" href="#Overall-and-expected-survival"><span>Overall and expected survival</span></a></li><li><a class="tocitem" href="#Estimated-net-survival"><span>Estimated net survival</span></a></li><li><a class="tocitem" href="#Net-survival-with-respect-to-covariates"><span>Net survival with respect to covariates</span></a></li><li><a class="tocitem" href="#Estimated-sample-size-and-life-expectancy"><span>Estimated sample size and life expectancy</span></a></li></ul></li><li><a class="tocitem" href="../benches/">Benchmarking results</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Case study</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Case study</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaSurv/NetSurvival.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaSurv/NetSurvival.jl/blob/main/docs/src/example.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Case-study"><a class="docs-heading-anchor" href="#Case-study">Case study</a><a id="Case-study-1"></a><a class="docs-heading-anchor-permalink" href="#Case-study" title="Permalink"></a></h1><h2 id="Introduction-and-datasets"><a class="docs-heading-anchor" href="#Introduction-and-datasets">Introduction and datasets</a><a id="Introduction-and-datasets-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction-and-datasets" title="Permalink"></a></h2><p>We will illustrate with an example using the dataset <code>colrec</code>, which comprises <span>$5971$</span> patients diagnosed with colon or rectal cancer between <span>$1994$</span> and <span>$2000$</span>. This dataset is sourced from the Slovenia cancer registry. Given the high probability that the patients are Slovenian, we will be using the Slovenian mortality table <code>slopop</code> as reference for the population mortality rates. Subsequently, we can apply various non-parametric estimators for net survival analysis.</p><div class="admonition is-info"><header class="admonition-header">N.B.</header><div class="admonition-body"><p>Mortality tables may vary in structure, with options such as the addition or removal of specific covariates. To confirm that the mortality table is in the correct format, please refer to <a href="https://JuliaSurv.github.io/RateTables.jl/"><code>RateTables.jl</code>&#39;s documentation</a>, or directly extract it from there.</p></div></div><h3 id="Cohort-details"><a class="docs-heading-anchor" href="#Cohort-details">Cohort details</a><a id="Cohort-details-1"></a><a class="docs-heading-anchor-permalink" href="#Cohort-details" title="Permalink"></a></h3><p>The patients in the study are diagnosed between January 1st <span>$1994$</span> and December 31st <span>$2000$</span>. Before we move on to the survival probabilities, it is important to be aware of how your data is distributed and of what it comprises. </p><pre><code class="language-julia hljs">using NetSurvival, RateTables, DataFrames
first(colrec,10)</code></pre><div><div style = "float: left;"><span>10×7 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">age</th><th style = "text-align: left;">year</th><th style = "text-align: left;">sex</th><th style = "text-align: left;">time</th><th style = "text-align: left;">status</th><th style = "text-align: left;">stage</th><th style = "text-align: left;">site</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Symbol" style = "text-align: left;">Symbol</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Bool" style = "text-align: left;">Bool</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "InlineStrings.String7" style = "text-align: left;">String7</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">23004.0</td><td style = "text-align: right;">728528.0</td><td style = "text-align: left;">male</td><td style = "text-align: right;">16.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">1</td><td style = "text-align: left;">rectum</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">12082.0</td><td style = "text-align: right;">729260.0</td><td style = "text-align: left;">female</td><td style = "text-align: right;">504.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">3</td><td style = "text-align: left;">rectum</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">24277.0</td><td style = "text-align: right;">728583.0</td><td style = "text-align: left;">male</td><td style = "text-align: right;">22.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">3</td><td style = "text-align: left;">colon</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">29256.0</td><td style = "text-align: right;">729843.0</td><td style = "text-align: left;">female</td><td style = "text-align: right;">3998.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">1</td><td style = "text-align: left;">colon</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">30416.0</td><td style = "text-align: right;">728869.0</td><td style = "text-align: left;">female</td><td style = "text-align: right;">9.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">99</td><td style = "text-align: left;">colon</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">15156.0</td><td style = "text-align: right;">729686.0</td><td style = "text-align: left;">male</td><td style = "text-align: right;">88.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">2</td><td style = "text-align: left;">colon</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">23953.0</td><td style = "text-align: right;">728713.0</td><td style = "text-align: left;">female</td><td style = "text-align: right;">7769.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">1</td><td style = "text-align: left;">rectum</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">20775.0</td><td style = "text-align: right;">728867.0</td><td style = "text-align: left;">male</td><td style = "text-align: right;">7366.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">1</td><td style = "text-align: left;">rectum</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">17555.0</td><td style = "text-align: right;">730141.0</td><td style = "text-align: left;">female</td><td style = "text-align: right;">6480.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">1</td><td style = "text-align: left;">rectum</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">20329.0</td><td style = "text-align: right;">730137.0</td><td style = "text-align: left;">female</td><td style = "text-align: right;">6449.0</td><td style = "text-align: right;">false</td><td style = "text-align: right;">1</td><td style = "text-align: left;">rectum</td></tr></tbody></table></div><p>Let&#39;s explore how our data is distributed first, starting with the <code>age</code> variable.</p><pre><code class="language-julia hljs">println(minimum(colrec.age./365.241), &quot; ; &quot;,maximum(colrec.age./365.241))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">12.482169307388821 ; 96.7169622249419</code></pre><p>The study can be considered diverse in terms of age seeing as the patients are between 12 and 96 years old, approximately. </p><pre><code class="language-julia hljs">using Plots
plot(histogram(colrec.age./365.241, label=&quot;Age&quot;),
    histogram(colrec.time./365.241, label=&quot;Follow-up time&quot;))</code></pre><img src="8bb03385.svg" alt="Example block output"/><p>The graph above show us that although the dataset has a wide range of patients within all age groups, it is mostly centered around older adults and elderly, with the majority of the patients being between <span>$60$</span> and <span>$80$</span> years old. Looking at the second graph that details the distribution of the follow-up times. We notice there that the values quickly drop. Unfortunately, this is a common theme in cancer studies. </p><p>Let&#39;s take a look at the <code>sex</code> variable now, by looking at the number of male and female patients:</p><pre><code class="language-julia hljs">combine(groupby(colrec, :sex), nrow)</code></pre><div><div style = "float: left;"><span>2×2 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">sex</th><th style = "text-align: left;">nrow</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Symbol" style = "text-align: left;">Symbol</th><th title = "Int64" style = "text-align: left;">Int64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">male</td><td style = "text-align: right;">3289</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">female</td><td style = "text-align: right;">2682</td></tr></tbody></table></div><p>There isn&#39;t too big of a difference between the two. We can say this study includes both gender relatively equally, thus, reducing bias. With these two observations, it is also worth noting that colorectal cancer is most common with men and people older than <span>$50$</span>.</p><p>In total, we note that we have <span>$5971$</span> patients. By taking a look at the <code>status</code> variable, we can determine the deaths and censorship:</p><pre><code class="language-julia hljs">sum(colrec.status)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4979</code></pre><p>Out of the <span>$5971$</span> patients, <span>$4979$</span> have died. This is a very high mortality rate, and again, unfortunately common in cancer studies.</p><pre><code class="language-julia hljs">(nrow(colrec) - sum(colrec.status)) / nrow(colrec)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.16613632557360575</code></pre><p>In other terms, the censorship rate is of 16.6%, meaning the event, in this case death, was not observed for only 16.6% of the patients. This is a low censorship rate and thus the quality of the signal will be pretty good. </p><h3 id="Mortality-table"><a class="docs-heading-anchor" href="#Mortality-table">Mortality table</a><a id="Mortality-table-1"></a><a class="docs-heading-anchor-permalink" href="#Mortality-table" title="Permalink"></a></h3><p>We will be using the mortality table <code>slopop</code> taken from the <code>RateTables.jl</code> package as the study is done on Slovenian patients. </p><pre><code class="language-julia hljs">slopop</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RateTable(:sex,)</code></pre><p>The show method of the <code>RateTable</code> class shows the additional covariate <code>sex</code> that the rate table has on top of the (mandatory) <code>age</code> and <code>year</code> variables. The <code>sex</code> variable has two madalities, <code>:male</code> and <code>:female</code>. The ratetable is then three dimensional. For example, the daily hazard rate for a woman turning <span>$45$</span> on the January 1st <span>$2006$</span> can be accessed through the following command:</p><pre><code class="language-julia hljs">λ  = daily_hazard(slopop, 45*365.241, 2006*365.241; sex=:female)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2.02680951796113e-6</code></pre><p>Making the daily survival probability easily calculated with:</p><pre><code class="language-julia hljs">exp(-λ)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.999997973192536</code></pre><h2 id="Overall-and-expected-survival"><a class="docs-heading-anchor" href="#Overall-and-expected-survival">Overall and expected survival</a><a id="Overall-and-expected-survival-1"></a><a class="docs-heading-anchor-permalink" href="#Overall-and-expected-survival" title="Permalink"></a></h2><p>For this part, we will be using the <code>Survival.jl</code> package to apply the Kaplan Meier estimator for the overall survival.</p><pre><code class="language-julia hljs">using Survival
km = fit(KaplanMeier, colrec.time./365.241, colrec.status)
plot(km.events.time, km.survival, label=false, title = &quot;Kaplan-Meier Estimator for the Overall Survival&quot;)</code></pre><img src="0020f193.svg" alt="Example block output"/><p>The graph above indicates a significant dip in survival probability within the first <span>$5$</span> years, and even more at <span>$10$</span> years. This period in the study is then crucial for the analysis. </p><h2 id="Estimated-net-survival"><a class="docs-heading-anchor" href="#Estimated-net-survival">Estimated net survival</a><a id="Estimated-net-survival-1"></a><a class="docs-heading-anchor-permalink" href="#Estimated-net-survival" title="Permalink"></a></h2><p>We will restrict ourselves to the first <span>$5$</span> years of the study. For that, let us re-censor the dataset as follows: </p><pre><code class="language-julia hljs">for i in 1:nrow(colrec)
    if colrec.time[i] &gt; 1826 # five years
        colrec.status[i] = false
        colrec.time[i] = 1826
    end
end</code></pre><p>We can now apply the different non-parametric methods to compute the relative survival.</p><pre><code class="language-julia hljs">e1 = fit(EdererI, @formula(Surv(time,status)~1), colrec, slopop)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">EdererI(t ∈ (1.0, 1826.0)) with summary stats:
 <span class="sgr1">1826×5 DataFrame</span>
<span class="sgr1">  Row </span>│<span class="sgr1"> Sₑ        ∂Λₑ           σₑ           lower_95_CI  upper_95_CI </span>
      │<span class="sgr90"> Float64   Float64       Float64      Float64      Float64     </span>
──────┼───────────────────────────────────────────────────────────────
    1 │ 0.997105   0.00289458   0.000710541     0.995718     0.998495
    2 │ 0.995215   0.00189576   0.000918415     0.993425     0.997008
    3 │ 0.992152   0.00307809   0.0011755       0.989869     0.99444
    4 │ 0.988753   0.00342609   0.00140734      0.986029     0.991484
    5 │ 0.986023   0.00276087   0.00157124      0.982991     0.989064
    6 │ 0.983292   0.00276916   0.00172041      0.979982     0.986614
    7 │ 0.981734   0.00158443   0.00180287      0.978271     0.98521
    8 │ 0.976991   0.00483135   0.00202379      0.973124     0.980874
  ⋮   │    ⋮           ⋮             ⋮            ⋮            ⋮
 1820 │ 0.456957  -0.000133259  0.0171307       0.441869     0.47256
 1821 │ 0.457018  -0.000133262  0.0171307       0.441928     0.472623
 1822 │ 0.457079  -0.000133307  0.0171307       0.441987     0.472686
 1823 │ 0.457139  -0.000133276  0.0171307       0.442045     0.472749
 1824 │ 0.456989   0.000328197  0.017137        0.441895     0.472599
 1825 │ 0.456839   0.000328384  0.0171432       0.441745     0.47245
 1826 │ 0.456478   0.000790464  0.0171556       0.441385     0.472088
<span class="sgr36">                                                     1811 rows omitted</span></code></pre><p>With the EdererI method, after <span>$1826$</span> days have passed, we can say that the survival rate at this mark is around <span>$0.456$</span>, in the hypothetical world where patients can only die of cancer.</p><pre><code class="language-julia hljs">crude_e1 = CrudeMortality(e1)
println(crude_e1.Mₒ[1826], &quot; , &quot;, crude_e1.Mₑ[1826], &quot; , &quot;, crude_e1.Mₚ[1826])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.636476800600479 , 0.515341453104102 , 0.121135347496377</code></pre><p>Out of the 0.63 patients that have died, according to the EdererI method, 0.51 died because of colorectal cancer and 0.12 died of other causes.</p><pre><code class="language-julia hljs">e2 = fit(EdererII, @formula(Surv(time,status)~1), colrec, slopop)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">EdererII(t ∈ (1.0, 1826.0)) with summary stats:
 <span class="sgr1">1826×5 DataFrame</span>
<span class="sgr1">  Row </span>│<span class="sgr1"> Sₑ        ∂Λₑ           σₑ           lower_95_CI  upper_95_CI </span>
      │<span class="sgr90"> Float64   Float64       Float64      Float64      Float64     </span>
──────┼───────────────────────────────────────────────────────────────
    1 │ 0.997105   0.00289456   0.000710541     0.995718     0.998495
    2 │ 0.995215   0.00189611   0.000918415     0.993425     0.997008
    3 │ 0.992151   0.00307874   0.0011755       0.989868     0.994439
    4 │ 0.988751   0.00342711   0.00140734      0.986027     0.991482
    5 │ 0.98602    0.00276208   0.00157124      0.982988     0.989061
    6 │ 0.983288   0.00277059   0.00172041      0.979978     0.986609
    7 │ 0.981728   0.00158595   0.00180287      0.978265     0.985203
    8 │ 0.976983   0.00483311   0.00202379      0.973116     0.980866
  ⋮   │    ⋮           ⋮             ⋮            ⋮            ⋮
 1820 │ 0.441589  -0.00011516   0.0171307       0.427008     0.456667
 1821 │ 0.44164   -0.000115156  0.0171307       0.427058     0.45672
 1822 │ 0.441691  -0.000115176  0.0171307       0.427107     0.456772
 1823 │ 0.441741  -0.000115213  0.0171307       0.427156     0.456825
 1824 │ 0.441588   0.00034624   0.017137        0.427003     0.456672
 1825 │ 0.441435   0.000346509  0.0171432       0.42685      0.45652
 1826 │ 0.441079   0.000808582  0.0171556       0.426494     0.456162
<span class="sgr36">                                                     1811 rows omitted</span></code></pre><p>Similarly, the EdererII method, also known as the conditional method, shows that at the <span>$5$</span> year mark, the survival probability is of <span>$0.44$</span> in this hypothetical world.</p><pre><code class="language-julia hljs">crude_e2 = CrudeMortality(e2)
println(crude_e2.Mₒ[1826], &quot; , &quot;, crude_e2.Mₑ[1826], &quot; , &quot;, crude_e2.Mₚ[1826])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.636476800600479 , 0.5329969626451269 , 0.10347983795535214</code></pre><p>Here, out of the 0.63 patients that have died, 0.53 are due to colorectal cancer and 0.1 due to other causes.</p><pre><code class="language-julia hljs">pp = fit(PoharPerme, @formula(Surv(time,status)~1), colrec, slopop)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PoharPerme(t ∈ (1.0, 1826.0)) with summary stats:
 <span class="sgr1">1826×5 DataFrame</span>
<span class="sgr1">  Row </span>│<span class="sgr1"> Sₑ        ∂Λₑ           σₑ           lower_95_CI  upper_95_CI </span>
      │<span class="sgr90"> Float64   Float64       Float64      Float64      Float64     </span>
──────┼───────────────────────────────────────────────────────────────
    1 │ 0.997105   0.00289493   0.000710632     0.995717     0.998495
    2 │ 0.995214   0.0018967    0.0009186       0.993424     0.997007
    3 │ 0.992149   0.00307987   0.00117581      0.989865     0.994438
    4 │ 0.988748   0.00342788   0.0014077       0.986024     0.99148
    5 │ 0.986016   0.00276316   0.0015717       0.982983     0.989058
    6 │ 0.983283   0.00277109   0.00172089      0.979972     0.986605
    7 │ 0.981722   0.00158763   0.0018035       0.978258     0.985199
    8 │ 0.976973   0.00483737   0.00202472      0.973104     0.980858
  ⋮   │    ⋮           ⋮             ⋮            ⋮            ⋮
 1820 │ 0.44187   -0.000148858  0.017886        0.426649     0.457635
 1821 │ 0.441936  -0.000148885  0.017886        0.426712     0.457703
 1822 │ 0.442002  -0.000148937  0.017886        0.426776     0.457772
 1823 │ 0.442068  -0.000149005  0.017886        0.426839     0.45784
 1824 │ 0.441843   0.00050879   0.0178981       0.426612     0.457618
 1825 │ 0.441721   0.000276025  0.0179032       0.42649      0.457496
 1826 │ 0.441362   0.000813485  0.0179164       0.426132     0.457136
<span class="sgr36">                                                     1811 rows omitted</span></code></pre><p>We conclude for the Pohar Perme method, that in a world where cancer patients could only die due to cancer, only 41% of these patients would still be alive <span>$5$</span> year after their diagnosis. The Pohar Perme estimator is the best estimator of the excess hazard under the standard hypotheses. </p><pre><code class="language-julia hljs">crude_pp = CrudeMortality(pp)
println(crude_pp.Mₒ[1826], &quot; , &quot;, crude_pp.Mₑ[1826], &quot; , &quot;, crude_pp.Mₚ[1826])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.6455403791714492 , 0.5314853737936457 , 0.1140550053778036</code></pre><p>Finally, for this estimator, we have that of the 0.64 patients that have died, 0.53 is due to colorectal cancer while 0.11 is due to other causes.</p><p>We will plot the Pohar Perme method only.</p><pre><code class="language-julia hljs">function mkribbon(pp)
    S = pp.Sₑ
    ci = confint(pp; level = 0.05)
    l,u = getindex.(ci, 1), getindex.(ci,2)
    rb = (S - l, u - S)
    return rb
end

p1 = plot(pp.grid, pp.Sₑ, ribbon=mkribbon(pp), xlab = &quot;Time (days)&quot;, ylab = &quot;Net survival&quot;, label = false)

p2 = plot(pp.grid, crude_pp.Mₑ, label = &quot;Excess Mortality Rate&quot;)
p2 = plot!(pp.grid, crude_pp.Mₚ, label = &quot;Population Mortality Rate&quot;)

plot(p1,p2)</code></pre><img src="e26f4cf4.svg" alt="Example block output"/><p>Looking at the graph, and the rapid dip it takes, it is evident that the first <span>$5$</span> years are crucial and that the survival probability is highly affected in these years. Additionally, the crude mortality graph allows us to see how much of this curve is due to the colorectal cancer studied versus other undefined causes. It is clear that the large majority is due to the cancer.</p><h2 id="Net-survival-with-respect-to-covariates"><a class="docs-heading-anchor" href="#Net-survival-with-respect-to-covariates">Net survival with respect to covariates</a><a id="Net-survival-with-respect-to-covariates-1"></a><a class="docs-heading-anchor-permalink" href="#Net-survival-with-respect-to-covariates" title="Permalink"></a></h2><p>We are now interested in comparing the different groups of patients defined by various covariates. </p><pre><code class="language-julia hljs">pp_sex = fit(PoharPerme, @formula(Surv(time,status)~sex), colrec, slopop)
pp_males = pp_sex[pp_sex.sex .== :male,:estimator][1]
pp_females = pp_sex[pp_sex.sex .== :female,:estimator][1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PoharPerme(t ∈ (1.0, 1826.0)) with summary stats:
 <span class="sgr1">1826×5 DataFrame</span>
<span class="sgr1">  Row </span>│<span class="sgr1"> Sₑ        ∂Λₑ           σₑ          lower_95_CI  upper_95_CI </span>
      │<span class="sgr90"> Float64   Float64       Float64     Float64      Float64     </span>
──────┼──────────────────────────────────────────────────────────────
    1 │ 0.99675    0.00325029   0.00111873     0.994567     0.998938
    2 │ 0.994244   0.00251419   0.00149396     0.991337     0.997159
    3 │ 0.989871   0.0043981    0.00198035     0.986036     0.99372
    4 │ 0.987363   0.00253401   0.00221726     0.983081     0.991663
    5 │ 0.983733   0.00367643   0.00251903     0.978888     0.988602
    6 │ 0.980104   0.00368904   0.00278998     0.974759     0.985478
    7 │ 0.97871    0.00142212   0.00289239     0.973177     0.984274
    8 │ 0.97321    0.00561896   0.00324789     0.967035     0.979425
  ⋮   │    ⋮           ⋮            ⋮            ⋮            ⋮
 1820 │ 0.450638  -0.000129968  0.0254941      0.428674     0.473727
 1821 │ 0.450697  -0.000129989  0.0254941      0.42873      0.473789
 1822 │ 0.450755  -0.000130047  0.0254941      0.428786     0.473851
 1823 │ 0.450814  -0.000130101  0.0254941      0.428841     0.473912
 1824 │ 0.450873  -0.000130144  0.0254941      0.428897     0.473974
 1825 │ 0.450513   0.000797147  0.025511       0.428541     0.473612
 1826 │ 0.450026   0.00108151   0.0255398      0.428054     0.473126
<span class="sgr36">                                                    1811 rows omitted</span></code></pre><p>When comparing at time <span>$1826$</span>, we notice that the survival probability is slightly inferior for men than for women (<span>$0.433 &lt; 0.449$</span>). It is also more probable for the women to die from other causes than the men seeing as <span>$0.0255 &gt; 0.025$</span>. Still, the differences are minimal. Let&#39;s confirm this with the Grafféo log-rank test:</p><pre><code class="language-julia hljs">test_sex = fit(GraffeoTest, @formula(Surv(time,status)~sex), colrec, slopop)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Grafféo&#39;s log-rank-type-test
<span class="sgr1">1×3 DataFrame</span>
<span class="sgr1"> Row </span>│<span class="sgr1"> test_statistic  degrees_of_freedom  p_value  </span>
     │<span class="sgr90"> Float64         Int64               Float64  </span>
─────┼──────────────────────────────────────────────
   1 │       0.533424                   1  0.465171</code></pre><p>The p-value is indeed above <span>$0.05$</span>. We cannot reject the null hypothesis <span>$H_0$</span> and thus we dismiss the differences between the two sexes.</p><p>As for the age, we will define two different groups: individuals aged 65 and above and those who are not.</p><pre><code class="language-julia hljs">colrec.age65 .= ifelse.(colrec.age .&gt;= 65*365.241, :old, :young)
pp_age65 = fit(PoharPerme, @formula(Surv(time,status)~age65), colrec, slopop)
pp_young = pp_age65[pp_age65.age65 .== :young, :estimator][1]
pp_old = pp_age65[pp_age65.age65 .== :old, :estimator][1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PoharPerme(t ∈ (1.0, 1826.0)) with summary stats:
 <span class="sgr1">1826×5 DataFrame</span>
<span class="sgr1">  Row </span>│<span class="sgr1"> Sₑ        ∂Λₑ           σₑ          lower_95_CI  upper_95_CI </span>
      │<span class="sgr90"> Float64   Float64       Float64     Float64      Float64     </span>
──────┼──────────────────────────────────────────────────────────────
    1 │ 0.996032   0.00396827   0.0010703      0.993944     0.998123
    2 │ 0.993167   0.00287628   0.00141168     0.990423     0.995919
    3 │ 0.988642   0.00455641   0.00181945     0.985122     0.992173
    4 │ 0.983839   0.0048581    0.00217215     0.979659     0.988036
    5 │ 0.980416   0.00347923   0.00239706     0.97582      0.985033
    6 │ 0.97644    0.00405544   0.00263427     0.971411     0.981494
    7 │ 0.974672   0.00180987   0.00273909     0.969454     0.979919
    8 │ 0.967646   0.00720934   0.0030984      0.961787     0.97354
  ⋮   │    ⋮           ⋮            ⋮            ⋮            ⋮
 1820 │ 0.402479  -0.000235167  0.0269303      0.381786     0.424294
 1821 │ 0.402574  -0.0002352    0.0269303      0.381876     0.424393
 1822 │ 0.402669  -0.000235279  0.0269303      0.381966     0.424493
 1823 │ 0.402763  -0.000235379  0.0269303      0.382056     0.424593
 1824 │ 0.402379   0.000955393  0.0269566      0.381671     0.424209
 1825 │ 0.402164   0.000534307  0.0269676      0.381459     0.423992
 1826 │ 0.401854   0.000770012  0.0269863      0.381151     0.423681
<span class="sgr36">                                                    1811 rows omitted</span></code></pre><p>Here, the difference between the two is much more important. In the first group, the individuals are aged under 65 and at <span>$5$</span> years time, they have a <span>$50.1$</span>% chance of survival. On the other hand, the individuals aged 65 and up have a <span>$40.1$</span>% chance of survival. </p><p>It is also worth noting that their chances of dying from other causes is higher than the younger group, given their age. </p><p>When applying the Grafféo test, we get the results below:</p><pre><code class="language-julia hljs">test_age65 = fit(GraffeoTest, @formula(Surv(time,status)~age65), colrec, slopop)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Grafféo&#39;s log-rank-type-test
<span class="sgr1">1×3 DataFrame</span>
<span class="sgr1"> Row </span>│<span class="sgr1"> test_statistic  degrees_of_freedom  p_value     </span>
     │<span class="sgr90"> Float64         Int64               Float64     </span>
─────┼─────────────────────────────────────────────────
   1 │        77.4381                   1  1.36951e-18</code></pre><p>The p-value is well under <span>$0.05$</span>, meaning we reject the <span>$H_0$</span> hypothesis and must admit there are differences between the individuals aged 65 and above and the others.</p><p>When plotting both we get:</p><pre><code class="language-julia hljs">plot1 = plot(pp_males.grid, pp_males.Sₑ, ribbon=mkribbon(pp_males), xlab = &quot;Time (days)&quot;, ylab = &quot;Net survival&quot;, label = &quot;men&quot;)
plot1 = plot!(plot1, pp_females.grid, pp_females.Sₑ, ribbon=mkribbon(pp_females), label = &quot;women&quot;)

plot2 = plot(pp_young.grid, pp_young.Sₑ, ribbon=mkribbon(pp_young), xlab = &quot;Time (days)&quot;, ylab = &quot;Net survival&quot;, label = &quot;Under 65&quot;)
plot2 = plot!(pp_old.grid, pp_old.Sₑ, ribbon=mkribbon(pp_old), label = &quot;65 and up&quot;)

plot(plot1, plot2, layout = (1, 2))</code></pre><img src="c486d20b.svg" alt="Example block output"/><p>Visually, it is almost immediately understood that there are no worthy differences between the two sexes whereas the <code>age65</code> variable seems to play a big role.</p><p>The same kind of graph can be made on the stage: </p><pre><code class="language-julia hljs">pp3 = fit(PoharPerme, @formula(Surv(time,status)~stage), colrec, slopop)
plot3 = plot(xlab = &quot;Time (days)&quot;, ylab = &quot;Net survival&quot;,title=&quot;Net survival per cancer stages&quot;)
for i in 1:nrow(pp3)
    e = pp3[i,:estimator]
    plot!(plot3, e.grid, e.Sₑ, ribbon=mkribbon(e), label=pp3[i,:stage])
end
plot(plot3)</code></pre><img src="362ecc30.svg" alt="Example block output"/><h2 id="Estimated-sample-size-and-life-expectancy"><a class="docs-heading-anchor" href="#Estimated-sample-size-and-life-expectancy">Estimated sample size and life expectancy</a><a id="Estimated-sample-size-and-life-expectancy-1"></a><a class="docs-heading-anchor-permalink" href="#Estimated-sample-size-and-life-expectancy" title="Permalink"></a></h2><p>Given that the age group plays a significant role in the study, we will now estimate the sample size by yearly intervals in order to better compare the age groups.</p><pre><code class="language-julia hljs">elt, ess = nessie(@formula(Surv(time,status)~age65), colrec, slopop)
elt</code></pre><div><div style = "float: left;"><span>2×2 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">age65</th><th style = "text-align: left;">expected_life_time</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Symbol" style = "text-align: left;">Symbol</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">young</td><td style = "text-align: right;">24.7882</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">old</td><td style = "text-align: right;">10.2949</td></tr></tbody></table></div><p>The expected life time for the younger patients is significatively higher than for older patients (24.78 years &gt; 10.29 years).</p><pre><code class="language-julia hljs">hcat(ess[:,3]...)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×2 Matrix{Float64}:
 2352.0   3619.0
 2323.53  3389.94
 2293.83  3168.85
 2262.95  2954.21
 2230.76  2746.24</code></pre><p>Finally, the table above represents yearly expected sample sizes for both age groups under 65 and above, with the second column representing the latter. We can see that the sample size decreases for the older patients in a much more dramatic way than for the younger ages.</p><p>Unsurprisingly, we can thus conclude that age plays an important role in the study.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../getting_started/">« Getting Started</a><a class="docs-footer-nextpage" href="../benches/">Benchmarking results »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Monday 2 December 2024 14:28">Monday 2 December 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
